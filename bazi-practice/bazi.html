<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ba Zi Earthly Branches Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body { height: 100%; margin: 0; padding: 0;}
    body {
      background: #f5f5f5;
      font-family: system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .container {
      background: #fff;
      border-radius: 16px;
      margin-top: 24px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      padding: 10px 4px 6px 4px;
      max-width: 410px;
      width: 99vw;
      min-height: 330px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h2 {
      margin-bottom: 0.3em;
      letter-spacing: 1px;
      color: #244;
      font-size: 1.1em;
    }
    .question {
      font-size: 1.18em;
      margin: 10px 0 6px 0;
      text-align: center;
      min-height: 38px;
    }
    .options {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 6px;
      margin-top: 2px;
      justify-items: center;
      align-items: center;
    }
    .option {
      background: #f1f3f8;
      border: none;
      border-radius: 9px;
      font-size: 2.1em;
      font-weight: bold;
      min-width: 42px;
      min-height: 42px;
      aspect-ratio: 1/1;
      cursor: pointer;
      transition: background .17s,transform .13s;
      box-shadow: 0 1px 2px rgba(0,0,0,0.035);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      user-select: none;
      line-height: 1.1;
    }
    .option.correct { background: #a7e3b1; }
    .option.wrong { background: #ffb8b8; }
    .option.selected { border: 2px solid #0078ff; }
    .option:disabled { opacity: .63; }
    .score, .timer { color: #355; font-size: 1em; margin-bottom: 6px;}
    .controls { margin-bottom: 15px; }
    .btn { background: #3b82f6; color: white; border: none; border-radius: 10px; padding: 8px 14px; font-size: .99em; margin:0 6px 0 0; cursor: pointer;}
    .btn:active { background: #1855b6;}
    .hide { display: none;}
    .summary { text-align: center; margin-top: 20px;}
    @media (max-width:480px) {
      .container { max-width: 99vw; margin-top: 2vw; padding: 2vw 0 2vw 0;}
      h2 { font-size: .98em;}
      .question { font-size: 1.05em;}
      .options { gap: 5px;}
      .option { min-width: 30px; min-height: 30px; font-size: 1.4em;}
    }
    @media (max-width:350px) {
      .container {padding:0;}
      .option {font-size:1em;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Ba Zi Earthly Branches Quiz</h2>
    <div class="controls" id="controls">
      <span>Questions:</span>
      <button class="btn" onclick="startQuiz(10)">10</button>
      <button class="btn" onclick="startQuiz(25)">25</button>
      <button class="btn" onclick="startQuiz(50)">50</button>
      <button class="btn" onclick="startQuiz(100)">100</button>
    </div>
    <div class="score hide" id="score"></div>
    <div class="timer hide" id="timer"></div>
    <div class="question hide" id="question"></div>
    <div class="options hide" id="options"></div>
    <div class="summary hide" id="summary"></div>
  </div>
<script>
const branches = ['子','丑','寅','卯','辰','巳','午','未','申','酉','戌','亥'];

// 六合 (Six Harmonies) pairs
const liuHe = [
  ['子','丑'], ['寅','亥'], ['卯','戌'], ['辰','酉'],
  ['巳','申'], ['午','未']
];

// 六冲 (Six Clashes) pairs
const liuChong = [
  ['子','午'], ['丑','未'], ['寅','申'], ['卯','酉'],
  ['辰','戌'], ['巳','亥']
];

// 三合 (Three Harmonies)
const sanHe = [
  ['申','子','辰'], // Water
  ['亥','卯','未'], // Wood
  ['寅','午','戌'], // Fire
  ['巳','酉','丑']  // Metal
];

let roundQuestions = 10;
let questions = [];
let questionIndex = 0;
let score = 0;
let timerInterval, elapsed = 0, timerRunning = false;

function shuffle(arr) {
  return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
}

function buildQuestions(num) {
  let allQ = [];
  // 六合 pairs (both directions)
  liuHe.forEach(([a,b])=>{
    allQ.push({type:'liuhe', base:a, answer:b});
    allQ.push({type:'liuhe', base:b, answer:a});
  });
  // 六冲 pairs (both directions)
  liuChong.forEach(([a,b])=>{
    allQ.push({type:'liuchong', base:a, answer:b});
    allQ.push({type:'liuchong', base:b, answer:a});
  });
  // 三合 groups (all directions, missing branch)
  sanHe.forEach(group=>{
    group.forEach((base, idx)=>{
      let ans = group.filter((_,i)=>i!==idx);
      allQ.push({type:'sanhe', base:base, answer:ans, group});
    });
  });
  allQ = shuffle(allQ);
  if(num>allQ.length) num = allQ.length;
  return allQ.slice(0,num);
}

function questionText(q) {
  if(q.type==='liuhe') return `What is the <b>六合</b> (Six Harmony) pair for 「${q.base}」?`;
  if(q.type==='liuchong') return `What is the <b>六冲</b> (Six Clash) pair for 「${q.base}」?`;
  if(q.type==='sanhe') {
    return `Which TWO branches form a <b>三合</b> (Three Harmony) group with 「${q.base}」?`;
  }
  return '';
}

function renderOptions(q) {
  const optionsDiv = document.getElementById('options');
  optionsDiv.innerHTML = '';
  if(q.type==='sanhe') {
    branches.forEach(b=>{
      const btn = document.createElement('button');
      btn.textContent = b;
      btn.className = 'option';
      btn.onclick = ()=>selectSanhe(btn, b);
      optionsDiv.appendChild(btn);
    });
  } else {
    branches.forEach(b=>{
      const btn = document.createElement('button');
      btn.textContent = b;
      btn.className = 'option';
      btn.onclick = ()=>selectOption(btn, b);
      optionsDiv.appendChild(btn);
    });
  }
}

let sanheSelected = [];
let isAnswering = true;

function selectSanhe(btn, b) {
  if(!isAnswering) return;
  if(sanheSelected.includes(b)) {
    btn.classList.remove('selected');
    sanheSelected = sanheSelected.filter(x=>x!==b);
    return;
  }
  if(sanheSelected.length<2) {
    btn.classList.add('selected');
    sanheSelected.push(b);
    if(sanheSelected.length===2) {
      checkSanheAnswer();
    }
  }
}

function checkSanheAnswer() {
  isAnswering = false;
  let q = questions[questionIndex];
  let correct = JSON.stringify([...q.answer].sort())===JSON.stringify([...sanheSelected].sort());
  document.querySelectorAll('.option').forEach(btn=>{
    if(q.answer.includes(btn.textContent)) btn.classList.add('correct');
    else if(sanheSelected.includes(btn.textContent)) btn.classList.add('wrong');
    btn.disabled = true;
  });
  if(correct) score++;
  updateScoreDisplay();
  setTimeout(()=>{
    questionIndex++;
    nextQuestionOrEnd();
  }, 750);
}

function selectOption(btn, b) {
  if(!isAnswering) return;
  isAnswering = false;
  let q = questions[questionIndex];
  let correct = (b === q.answer);
  document.querySelectorAll('.option').forEach(option=>{
    if(option.textContent === q.answer) option.classList.add('correct');
    if(option.textContent === b && !correct) option.classList.add('wrong');
    option.disabled = true;
  });
  if(correct) score++;
  updateScoreDisplay();
  setTimeout(()=>{
    questionIndex++;
    nextQuestionOrEnd();
  }, 650);
}

function startQuiz(n) {
  roundQuestions = n;
  questions = buildQuestions(n);
  questionIndex = 0;
  score = 0;
  elapsed = 0;
  document.getElementById('controls').classList.add('hide');
  document.getElementById('score').classList.remove('hide');
  document.getElementById('timer').classList.remove('hide');
  document.getElementById('summary').classList.add('hide');
  document.getElementById('options').classList.remove('hide');
  document.getElementById('question').classList.remove('hide');
  updateTimer();
  updateScoreDisplay();
  if(timerInterval) clearInterval(timerInterval);
  timerRunning = true;
  timerInterval = setInterval(()=>{
    if(timerRunning) {
      elapsed++;
      updateTimer();
    }
  },1000);
  nextQuestion();
}

function nextQuestion() {
  isAnswering = true;
  sanheSelected = [];
  if(questionIndex >= questions.length) {
    endQuiz();
    return;
  }
  let q = questions[questionIndex];
  document.getElementById('question').innerHTML = questionText(q);
  renderOptions(q);
}

function nextQuestionOrEnd() {
  if(questionIndex >= questions.length) {
    endQuiz();
  } else {
    nextQuestion();
    updateScoreDisplay();
  }
}

function updateTimer() {
  document.getElementById('timer').innerHTML = `<b>Time:</b> ${elapsed}s`;
}

function updateScoreDisplay() {
  document.getElementById('score').textContent = `Score: ${score}/${questionIndex+1 > questions.length ? questions.length : questionIndex+1}`;
}

function endQuiz() {
  timerRunning = false;
  if(timerInterval) clearInterval(timerInterval);
  document.getElementById('question').classList.add('hide');
  document.getElementById('options').classList.add('hide');
  document.getElementById('score').classList.add('hide');
  document.getElementById('timer').classList.add('hide');
  document.getElementById('summary').classList.remove('hide');
  document.getElementById('summary').innerHTML = `
    <h3>Quiz Finished!</h3>
    <p>Score: <b>${score} / ${questions.length}</b></p>
    <p>Total time: <b>${elapsed} seconds</b></p>
    <button class="btn" onclick="resetQuiz()">Try Again</button>
  `;
}

function resetQuiz() {
  document.getElementById('summary').classList.add('hide');
  document.getElementById('controls').classList.remove('hide');
}
</script>
</body>
</html>